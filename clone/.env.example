POSTGRES_DB=acobra
POSTGRES_USER=acobra
POSTGRES_PASSWORD=troque_essa_senha

DATABASE_URL=postgresql+asyncpg://acobra:troque_essa_senha@db:3291/acobra
REDIS_URL=redis://redis:6379/0

LOG_LEVEL=INFO
API_PORT=8080

# Auth (API)
AUTH_REQUIRED=1
API_KEYS=troque-por-um-token-bem-grande
# Use em clientes que chamam a API (bot, pncp_fetch)
API_KEY=troque-por-um-token-bem-grande
CORE_API_KEY=troque-por-um-token-bem-grande

# Rate limiting (por API key)
RATE_LIMIT_ENABLED=1
RATE_LIMIT_RPM=300
RATE_LIMIT_BYPASS_KEYS=

# Alertas autom√°ticos
ALERTS_ENABLED=1
ALERTS_POLL_S=60
ALERTS_COOLDOWN_S=300
ALERTS_PREFIX=alerts:v1
ALERTS_QUEUE_THRESHOLDS=q:triage=500,q:fetch_parse=1000,q:parse=200,q:dead_triage=10,q:dead_fetch_docs=50,q:dead_parse=10
ALERTS_COUNTER_THRESHOLDS=api.errors_5xx_total=5,worker.triage.dead_total=1,worker.fetch_docs.dead_total=1,worker.parse.dead_total=1
# Sugestoes por ambiente:
# DEV:
# ALERTS_QUEUE_THRESHOLDS=q:triage=50,q:fetch_parse=20,q:parse=20,q:dead_triage=1,q:dead_fetch_docs=1,q:dead_parse=1
# ALERTS_COUNTER_THRESHOLDS=api.errors_5xx_total=2,worker.triage.dead_total=1,worker.fetch_docs.dead_total=1,worker.parse.dead_total=1
# STAGING:
# ALERTS_QUEUE_THRESHOLDS=q:triage=200,q:fetch_parse=100,q:parse=100,q:dead_triage=1,q:dead_fetch_docs=1,q:dead_parse=1
# ALERTS_COUNTER_THRESHOLDS=api.errors_5xx_total=3,worker.triage.dead_total=1,worker.fetch_docs.dead_total=1,worker.parse.dead_total=1
# PROD:
# ALERTS_QUEUE_THRESHOLDS=q:triage=1000,q:fetch_parse=500,q:parse=500,q:dead_triage=1,q:dead_fetch_docs=1,q:dead_parse=1
# ALERTS_COUNTER_THRESHOLDS=api.errors_5xx_total=10,worker.triage.dead_total=1,worker.fetch_docs.dead_total=2,worker.parse.dead_total=2
# Se quiser usar um bot diferente dos alerts, preencha:
ALERTS_TELEGRAM_BOT_TOKEN=
ALERTS_TELEGRAM_CHAT_ID=

# Compras.gov.br (licitacoes)
COMPRAS_API_BASE=https://compras.dados.gov.br
COMPRAS_LIST_PATH=/licitacoes/v1/licitacoes.json
COMPRAS_DETAIL_PATH=/licitacoes/id/licitacao/{id}.json
COMPRAS_POLL_S=3600
COMPRAS_MAX_PAGES=10
COMPRAS_MAX_ITEMS=500
# Campo para filtros de data: data_abertura_proposta | data_entrega_edital (exemplos da API)
COMPRAS_DATE_FIELD=data_abertura_proposta
COMPRAS_DATA_INICIAL=
COMPRAS_DATA_FINAL=
COMPRAS_UASG=

# Event log (audit pipeline)
EVENT_LOG_ENABLED=1
EVENT_LOG_SAMPLE=1.0

# Cache (API)
CACHE_ENABLED=1
CACHE_PREFIX=api-cache:v1
CACHE_TTL_S=60
CACHE_MAX_BYTES=524288
CACHE_TTL_S_MAP={"\/health":5,"\/v1/subscriptions":30,"\/v1/documents":30}
CACHE_METRICS_TTL_S=604800
CACHE_LOCK_TTL_S=8
CACHE_LOCK_WAIT_MS=200

# Metrics / Observability
METRICS_ENABLED=1
METRICS_PREFIX=metrics:v1
METRICS_TTL_S=604800
QUEUE_METRICS_LIST=q:triage,q:fetch_parse,q:parse,q:parse_smoke,q:dead_triage,q:dead_fetch_docs,q:dead_parse
METRICS_HISTOGRAM_BUCKETS_MS=50,100,200,500,1000,2000,5000

# Queue backpressure
QUEUE_MAX_LEN=10000

# Retries / Dead-letter
FETCH_MAX_RETRIES=3
FETCH_RETRY_BACKOFF_S=2.0
PARSE_MAX_RETRIES=3
PARSE_RETRY_BACKOFF_S=2.0
PARSE_DEAD_QUEUE=q:dead_parse
TRIAGE_MAX_RETRIES=3
TRIAGE_RETRY_BACKOFF_S=2.0
TRIAGE_DEAD_QUEUE=q:dead_triage

TELEGRAM_BOT_TOKEN=8456052137:AAEKsfID_Q2GliscLo2_ve8MVZnBxJ_XOqU
BOT_USERNAME=
TELEGRAM_UF_CHANNELS=SP:-5141878597

# OCR / Parse
PARSE_OCR=0
OCR_MIN_TEXT=200
OCR_MIN_QUALITY=0.25
OCR_MAX_BYTES=20971520
OCR_TIMEOUT_S=120
OCR_LANG=por+eng
OCR_JOBS=2
OCR_DPI=150
OCR_MAX_PAGES=12
OCR_PAGE_TIMEOUT_S=60
OCR_MODE=pages

# Parse (smoke / prioridade)
PARSE_QUEUE_LIST=
PARSE_SMOKE_QUEUE=q:parse_smoke
PARSE_SMOKE_DISABLE_OCR=1
PARSE_SMOKE_DISABLE_EMBEDDINGS=1
PARSE_SMOKE_DROP_BODY=1
PARSE_SMOKE_MAX_CHARS=20000

# Tabelas / conversao
TABLE_EXTRACT_ENABLED=0
TABLE_EXTRACT_MAX_BYTES=10485760
TABLE_EXTRACT_MAX_PAGES=5
TABLE_EXTRACT_FLAVOR=stream
DOC_CONVERT_ENABLED=0
DOC_CONVERT_STRATEGY=auto

# Agent enrichment (CrewAI/Ollama)
AGENT_ENABLED=0
AGENT_URL=
AGENT_TIMEOUT_S=15
AGENT_MIN_CHARS=300
AGENT_MAX_CHARS=4000
AGENT_FORCE=0
